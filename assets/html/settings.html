<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <title>Configura√ß√µes ‚Ä¢ JV-Printer</title>
    <link rel="stylesheet" href="../css/bootstrap5.0.2.min.css" />
    <style>
      body {
        background: #f7f7f7;
      }
      .card {
        max-width: 420px;
        margin: 60px auto;
        padding: 25px 30px;
        border: 0;
        box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
      }
      .card h5 {
        font-weight: 600;
        margin-bottom: 20px;
        color: #333;
      }
      .form-icon {
        width: 28px;
        text-align: center;
        color: #0d6efd;
      }
    </style>
  </head>

  <body>
    <div class="card">
      <h5 class="text-center">Configura√ß√µes</h5>

      <form id="cfg">
        <!-- ID empresa -->
        <div class="input-group mb-3">
          <span class="input-group-text form-icon">üè¢</span>
          <input
            class="form-control"
            id="idempresa"
            type="number"
            min="1"
            placeholder="ID da empresa"
            required
          />
        </div>

        <!-- Link API -->
        <div class="input-group mb-3">
          <span class="input-group-text form-icon">üåê</span>
          <input
            class="form-control"
            id="api"
            type="url"
            placeholder="https://api.seusistema.com"
            required
          />
        </div>

        <!-- Token API -->
        <div class="input-group mb-3">
          <span class="input-group-text form-icon">üîë</span>
          <input
            class="form-control"
            id="token"
            type="text"
            placeholder="Token de autentica√ß√£o da API"
            required
          />
        </div>

        <!-- Nome impressora -->
        <div class="input-group mb-4">
          <div class="mb-4">
            <label class="form-label">üñ®Ô∏è Impressora instalada</label>
            <select class="form-select" id="printer" required>
              <option value="">Selecione a impressora</option>
            </select>
          </div>
        </div>

        <button class="btn btn-primary w-100" type="submit">Salvar</button>
      </form>
    </div>

    <script src="../js/bootstrap5.0.2.js"></script>
    <script>
      (async () => {

        const selected = (await window.api.getStore('printer')) || '';
        const lista = await window.api.getPrinters();
        const select = document.getElementById('printer');
        lista.data.forEach((nome) => {
          const opt = document.createElement('option');
          opt.value = nome;
          opt.textContent = nome;
          if (nome === selected) opt.selected = true;
          select.appendChild(opt);
        });

       
        document.getElementById('idempresa').value = await window.api.getStore('idempresa') ?? '';
        document.getElementById('api').value = await window.api.getStore('apiUrl')?? '';
        document.getElementById('token').value = await window.api.getStore('apiToken')?? '';

      })();

      cfg.onsubmit = (e) => {
        e.preventDefault();

        const idempresa = document.getElementById('idempresa').value.trim();
        const apiUrl = document.getElementById('api').value.trim();
        const apiToken = document.getElementById('token').value.trim();
        const printer = document.getElementById('printer').value;

        if (!apiUrl.startsWith('http')) {
          alert('Link da API inv√°lido');
          return;
        }
        if (!/^\d+$/.test(idempresa)) {
          alert('ID da empresa deve conter apenas n√∫meros');
          return;
        }

        window.api.send('settings-saved', {
          idempresa,
          apiUrl,
          apiToken,
          printer,
        });

        alert('Configura√ß√µes salvas!');
        window.close();
      };
    </script>
  </body>
</html>
